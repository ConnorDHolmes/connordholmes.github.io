"use strict";const root=document.documentElement,body=document.body,nav=document.querySelector("nav"),startButton=document.getElementById("start-button"),hiddenKey=document.querySelector("c-control[hide]"),screen=document.querySelector("c-screen"),list=document.querySelector("ul"),listEntries=list.querySelectorAll("li"),listCount=listEntries.length,listMap=new Map,fpsBenchmark=60,frameDurationBenchmark=16.666666666666668;let before=document.timeline.currentTime,multiplier=1,everyOtherFrame=!0;const win={get w(){return window.innerWidth},get h(){return window.innerHeight},get midX(){return win.w/2},get midY(){return win.h/2}},sceneEl=document.querySelector("c-scene"),scene={h:sceneEl.offsetHeight,get scale(){return win.h/scene.h}},cursorEl=document.querySelector("c-cursor"),cursor={x:{target:win.midX,eased:win.midX},y:{target:win.midY,eased:win.midY},half:.5*cursorEl.offsetWidth},cameraPos=new Map;cameraPos.set("orbit",{hor:3,vert:2,zoom:-864,adj:90}),cameraPos.set("normal",{hor:95,vert:50,zoom:512,adj:0}),cameraPos.set("focused",{hor:1,vert:1,zoom:576,adj:0});const roomEl=document.querySelector("c-room"),room={range:{mode:"orbit",hor:{get target(){return cameraPos.get(room.range.mode).hor},eased:3,get cone(){return 2*room.range.hor.eased},get isInactive(){return .5>Math.abs(this.target-this.eased)}},vert:{get target(){return cameraPos.get(room.range.mode).vert},eased:2,get cone(){return 2*room.range.vert.eased},get isInactive(){return .5>Math.abs(this.target-this.eased)}},zoom:{get target(){return cameraPos.get(room.range.mode).zoom},eased:-1024,get isInactive(){return .5>Math.abs(this.target-this.eased)}},adj:{get target(){return cameraPos.get(room.range.mode).adj},eased:90,get isInactive(){return .5>Math.abs(this.target-this.eased)}}},x:{get target(){return cursor.x.target},eased:cursor.x.target},y:{get target(){return cursor.y.target},eased:cursor.y.target},get pan(){return-room.range.hor.eased+room.x.eased/win.w*room.range.hor.cone+room.range.adj.eased},get tilt(){return room.range.vert.eased-room.y.eased/win.h*room.range.vert.cone}};cursor.x.ease=cursor.y.ease=.25,room.x.ease=room.y.ease=.15,room.range.hor.ease=room.range.vert.ease=room.range.adj.ease=.05,room.range.zoom.ease=.04;const easedTraits=[cursor.x,cursor.y,room.x,room.y,room.range.hor,room.range.vert,room.range.zoom,room.range.adj,];function populateDataText(){document.querySelectorAll("[data-text]").forEach(e=>{e.setAttribute("data-text",e.innerHTML)})}function addCl(e,r){e.classList.contains(r)||e.classList.add(r)}function remCl(e,r){e.classList.contains(r)&&e.classList.remove(r)}function togCl(e,r){e.classList.toggle(r)}function addBl(e,r){e.hasAttribute(r)||e.setAttribute(r,"")}function remBl(e,r){e.hasAttribute(r)&&e.removeAttribute(r)}function cloneListEntries(){listEntries.forEach(e=>{let r=e.cloneNode(!0);listMap.set(e,r),listMap.set(r,e),list.append(r)})}function cloneScreen(){let e=screen.cloneNode(!0),r=screen.querySelectorAll("*"),t=new Map,o=new MutationObserver(function e(r){r.forEach(e=>{t.get(e.target).classList=e.target.classList})});r.forEach((r,a)=>{(r.hasAttribute("data-m")||r.hasAttribute("data-h"))&&(t.set(r,e.querySelectorAll("*")[a]),o.observe(r,{attributeFilter:["class"]}))});let a=t.get(list);a.scrollTop=list.scrollTop=1;let s=listEntries[0].offsetHeight,n=parseInt(getComputedStyle(list).getPropertyValue("--gap").split("p")[0]),l=(s+n)*listCount;list.addEventListener("wheel",e=>{list.scrollTop>=l?a.scrollTop=list.scrollTop=1:0===list.scrollTop?a.scrollTop=list.scrollTop=l-1:a.scrollTop=list.scrollTop+=e.deltaY},{passive:!0}),document.querySelector("c-reflection").append(e)}function ease(e){e.eased+=(e.target-e.eased)*(e.ease*multiplier)}function updateHoveredEl(){let e=document.elementFromPoint(cursor.x.eased,cursor.y.eased);hoverableEls.includes(e)?(hoverableEls.forEach(r=>{r===e||r===listMap.get(e)?addCl(r,"hover"):remCl(r,"hover")}),addBl(cursorEl,"clickable")):(hoverableEls.forEach(e=>{remCl(e,"hover")}),remBl(cursorEl,"clickable"))}function refresh(e){let r=e-before;before=e,multiplier=r/16.666666666666668,roomEl.style.transform=`translate3d(0, 0, ${room.range.zoom.eased}px) rotate3d(1, 0, 0, ${room.tilt}deg) rotate3d(0, 1, 0, ${room.pan}deg)`,cursorEl.style.transform=`translate3d(${cursor.x.eased}px, ${cursor.y.eased}px, 0)`,easedTraits.forEach(e=>{!e.isInactive&&ease(e)}),everyOtherFrame&&updateHoveredEl(),everyOtherFrame=!everyOtherFrame,requestAnimationFrame(refresh)}function measureAndSize(){sceneEl.style.transform=`scale(${scene.scale})`,resetView()}function resetView(){cursor.x.target=win.midX,cursor.y.target=win.midY,addBl(cursorEl,"hide")}function reveal(){remCl(body,"overlay")}function navToScreen(){addCl(nav,"hide"),setTimeout(()=>{room.range.mode="focused",remBl(hiddenKey,"hide"),remBl(roomEl,"backface"),addCl(nav,"remove")},350)}function allClickHandlers(){document.addEventListener("click",e=>{e.target===startButton&&navToScreen()})}window.addEventListener("resize",measureAndSize),window.addEventListener("blur",resetView),root.addEventListener("blur",resetView),document.addEventListener("mousemove",e=>{cursor.x.target=e.pageX-cursor.half,cursor.y.target=e.pageY-cursor.half,remBl(cursorEl,"hide")}),root.addEventListener("mouseleave",resetView),root.addEventListener("mouseenter",e=>{cursor.x.eased=e.pageX-cursor.half,cursor.y.eased=e.pageY-cursor.half}),document.addEventListener("keyup",e=>{"Shift"===e.key?"orbit"!==room.range.mode&&("normal"===room.range.mode?room.range.mode="focused":room.range.mode="normal"):"m"===e.key||"M"===e.key?togCl(body,"light-mode"):("e"===e.key||"E"===e.key)&&togCl(body,"performance-mode")}),document.addEventListener("readystatechange",e=>{"complete"===e.target.readyState&&reveal()}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{e.matches?remCl(body,"light-mode"):addCl(body,"light-mode")}),window.matchMedia("(prefers-color-scheme: light)").matches&&addCl(body,"light-mode"),populateDataText(),cloneListEntries();const hoverableEls=[...document.querySelectorAll("[data-h]")];cloneScreen(),allClickHandlers(),measureAndSize(),requestAnimationFrame(refresh);